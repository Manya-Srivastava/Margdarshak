<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic Bus Routes</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #eef2f5;
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100vw;
            overflow: hidden;
        }

        .header {
            background-color: #202b37;
            color: white;
            text-align: center;
            padding: 16px;
            flex-shrink: 0;
        }

        .content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 20%;
            padding: 18px;
            background-color: #324454;
            color: rgb(203, 197, 197);
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .sidebar select,
        .sidebar button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            color: #212931;
            background-color: #5a7a93;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .sidebar select:hover,
        .sidebar button:hover {
            background-color: #48697f;
        }

        .info-panel {
            background-color: #1e2a38;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
        }

        .info-panel h3 {
            margin: 0 0 10px;
            font-size: 1.1em;
        }

        .info-panel p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .map-section {
            flex: 1;
            padding: 20px;
            background-color: #eef2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
        }

        .map-section h2 {
            margin-bottom: 10px;
            text-align: center;
        }

        #map {
            width: 100%;
            height: calc(100% - 40px);
            background-color: #d0d0d0;
            border-radius: 8px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .footer {
            background-color: #1e2a38;
            color: white;
            text-align: center;
            padding: 10px;
            flex-shrink: 0;
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6zb2QZMlXgad7nZz20VZ082DHe2xnUuE"></script>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Realistic Bus Routes</h1>
            <p>Real-Time Traffic and Weather Integration</p>
        </div>

        <div class="content">
            <div class="sidebar">
                <h2>Menu</h2>
                <select id="busSelector">
                    <!-- Dynamically populated with 75 bus IDs -->
                </select>
                <button id="showRoute">Show Route</button>
                <div class="info-panel" id="infoPanel">
                    <h3>Bus Details</h3>
                    <p id="busInfo">Select a bus to see details.</p>
                    <p id="destinationInfo"></p>
                    <p id="etaInfo"></p>
                </div>
            </div>

            <div class="map-section">
                <h2>Route Map</h2>
                <div id="map"></div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2024 Transit Optimization AI</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const map = L.map('map').setView([28.6139, 77.2090], 12); // Centered on Delhi

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            const busIDs = Array.from({ length: 75 }, (_, i) => `DL1PD46${83 + i}`);
            const busSelector = document.getElementById('busSelector');
            busIDs.forEach(id => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = id;
                busSelector.appendChild(option);
            });

            let activePolyline;
            let marker;
            let destinationMarker;

            function fetchRouteAndTime(origin, destination) {
                return new Promise((resolve, reject) => {
                    const directionsService = new google.maps.DirectionsService();

                    directionsService.route({
                        origin: origin,
                        destination: destination,
                        travelMode: google.maps.TravelMode.DRIVING
                    }, (response, status) => {
                        if (status === google.maps.DirectionsStatus.OK) {
                            const route = response.routes[0].overview_path.map(p => [p.lat(), p.lng()]);
                            const duration = response.routes[0].legs[0].duration.text; // Travel time
                            resolve({ route, duration });
                        } else {
                            reject('Could not fetch route');
                        }
                    });
                });
            }

            function fetchLocationName(lat, lng) {
                return new Promise((resolve, reject) => {
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ location: { lat, lng } }, (results, status) => {
                        if (status === google.maps.GeocoderStatus.OK && results[0]) {
                            resolve(results[0].formatted_address);
                        } else {
                            reject('Could not fetch location name');
                        }
                    });
                });
            }

            document.getElementById('showRoute').addEventListener('click', async () => {
                const selectedBus = busSelector.value;
                const origin = { lat: 28.6139, lng: 77.2090 }; // Delhi
                const destination = {
                    lat: 28.6139 + Math.random() * 0.1,
                    lng: 77.2090 + Math.random() * 0.1
                };

                try {
                    const { route, duration } = await fetchRouteAndTime(origin, destination);
                    const locationName = await fetchLocationName(destination.lat, destination.lng);

                    if (activePolyline) map.removeLayer(activePolyline);
                    if (marker) map.removeLayer(marker);
                    if (destinationMarker) map.removeLayer(destinationMarker);

                    activePolyline = L.polyline(route, { color: 'blue' }).addTo(map);
                    map.fitBounds(activePolyline.getBounds());

                    marker = L.circleMarker(route[0], { radius: 8, color: 'red', fillOpacity: 0.8 }).addTo(map);
                    destinationMarker = L.marker([destination.lat, destination.lng]).addTo(map)
                        .bindPopup(`<b>Destination:</b> ${locationName}<br><b>ETA:</b> ${duration}`)
                        .openPopup();

                    document.getElementById('busInfo').textContent = `Bus ID: ${selectedBus}`;
                    document.getElementById('destinationInfo').textContent = `Destination: ${locationName}`;
                    document.getElementById('etaInfo').textContent = `Estimated Arrival: ${duration}`;
                } catch (error) {
                    alert('Error: ' + error);
                }
            });
        });
    </script>
</body>
</html>
